<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tokens Manager</title>
  <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();class mt{constructor(){this.collections=[],this.variables=[],this.selectedCollectionId=null,this.collapsedGroups=new Set,this.searchQuery=""}setData(t,n){this.collections=t,this.variables=n,!this.selectedCollectionId&&t.length&&(this.selectedCollectionId=t[0].id)}setSearchQuery(t){this.searchQuery=t.toLowerCase().trim()}getFilteredVariables(){let t=this.variables.filter(n=>n.collectionId===this.selectedCollectionId);return this.searchQuery&&(t=t.filter(n=>n.name.toLowerCase().includes(this.searchQuery))),t}getFilteredCount(){const t=this.variables.filter(s=>s.collectionId===this.selectedCollectionId).length;return{shown:this.getFilteredVariables().length,total:t}}toggleGroup(t){this.collapsedGroups.has(t)?this.collapsedGroups.delete(t):this.collapsedGroups.add(t)}isGroupCollapsed(t){return this.collapsedGroups.has(t)}}const m=new mt;function p(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function E(e){parent.postMessage({pluginMessage:e},"*")}function f(e){return document.getElementById(e)}const We={COLOR:'<svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M7.312 6.803a7 7 0 0 1 9.639.248l.28.298a7 7 0 0 1 1.76 4.998l-.029.38C18.807 14.222 17.446 15 16.242 15H13.5l-.101.01a.5.5 0 0 0-.4.49v.5c0 .82-.338 1.603-.92 2.127-.6.542-1.468.8-2.37.488a7 7 0 0 1-2.362-1.385l-.297-.28a7 7 0 0 1 0-9.9zm8.93.955a6 6 0 0 0-8.485 0l-.212.225a6 6 0 0 0 2.492 9.689c.978.337 1.848-.457 1.953-1.467L12 16v-.499a1.5 1.5 0 0 1 1.5-1.5h2.743l.158-.006c.733-.057 1.391-.513 1.543-1.216l.024-.155a6 6 0 0 0-1.484-4.611zM8.5 12.001a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7-2a1 1 0 1 1-.001 2 1 1 0 0 1 0-2m-6-1.5a1 1 0 1 1 0 2.001 1 1 0 0 1 0-2m3.5-1a1 1 0 1 1 0 2 1 1 0 0 1 0-2"></path></svg>',FLOAT:'<svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16 6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2zM8 7a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zm3.05 2.002a.5.5 0 0 1 .448.547l-.045.452h1.495l.055-.55a.5.5 0 0 1 .995.098l-.045.452h.547a.5.5 0 1 1 0 1h-.648l-.199 2h.847a.5.5 0 1 1 0 1h-.948l-.054.548a.501.501 0 0 1-.995-.098l.044-.45h-1.495l-.054.548a.501.501 0 0 1-.995-.098l.044-.45H9.5a.5.5 0 0 1 0-1h.647l.2-2H9.5a.5.5 0 0 1 0-1h.948l.055-.55a.5.5 0 0 1 .546-.449m.302 1.999-.199 2h1.494l.2-2z"></path></svg>',STRING:'<svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M8 7h8a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1M6 8a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2zm3.5 1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 1 0V10h1.5v4H11a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-.5v-4H14v.5a.5.5 0 0 0 1 0v-1a.5.5 0 0 0-.5-.5z" clip-rule="evenodd"></path></svg>',BOOLEAN:'<svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10 8h4a4 4 0 0 1 0 8h-4a4 4 0 0 1 0-8m-5 4a5 5 0 0 1 5-5h4a5 5 0 0 1 0 10h-4a5 5 0 0 1-5-5m5 2a2 2 0 1 1 0-4 2 2 0 0 1 0 4m-3-2a3 3 0 1 1 6 0 3 3 0 0 1-6 0" clip-rule="evenodd"></path></svg>'},P={drag:'<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>',plus:'<svg viewBox="0 0 16 16"><path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" fill="none"/></svg>',close:'<svg width="12" height="12" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2"/></svg>',refresh:'<svg viewBox="0 0 16 16"><path d="M13.65 2.35A8 8 0 1 0 16 8h-2a6 6 0 1 1-1.76-4.24L10 6h6V0l-2.35 2.35z" fill="currentColor"/></svg>',expand:'<svg viewBox="0 0 16 16"><path d="M2 6V2h4M10 2h4v4M14 10v4h-4M6 14H2v-4" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></svg>',collapse:'<svg viewBox="0 0 16 16"><path d="M6 2v4H2M14 6h-4V2M10 14v-4h4M2 10h4v4" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></svg>',chevronDown:'<svg viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2"/></svg>',shades:'<svg viewBox="0 0 16 16" width="14" height="14"><rect x="1" y="2" width="3" height="12" rx="1" fill="currentColor" opacity="0.2"/><rect x="5" y="2" width="3" height="12" rx="1" fill="currentColor" opacity="0.5"/><rect x="9" y="2" width="3" height="12" rx="1" fill="currentColor" opacity="0.8"/><rect x="13" y="2" width="2" height="12" rx="1" fill="currentColor"/></svg>',steps:'<svg viewBox="0 0 16 16" width="14" height="14"><path d="M2 14h3v-3H2v3zm4-5h3v-3H6v3zm4-5h3V1h-3v3z" fill="currentColor"/><path d="M2 14l12-12" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>',copy:'<svg viewBox="0 0 16 16" width="12" height="12"><rect x="2" y="5" width="8" height="9" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M5 5V3a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1h-2" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>',trash:'<svg viewBox="0 0 16 16" width="12" height="12"><path d="M5.5 2v1h5V2h-5zM4 4v9a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4H4zm2.5 2v5m3-5v5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>',search:'<svg viewBox="0 0 16 16" width="14" height="14"><circle cx="6.5" cy="6.5" r="4" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M10 10l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>',edit:'<svg viewBox="0 0 16 16" width="12" height="12"><path d="M11.5 2.5l2 2M3 11l-1 3 3-1 8-8-2-2-8 8z" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>'};function Xe(e){return We[e]||String(e)}function ft(){const e=document.getElementById("collection-select");e&&(e.innerHTML=m.collections.map(t=>`<option value="${t.id}" ${t.id===m.selectedCollectionId?"selected":""}>${p(t.name)}</option>`).join("")||'<option value="">No collections</option>')}function ee(){const e=document.getElementById("table-body");if(!e)return;const t=m.getFilteredVariables();if(!t.length){e.innerHTML=`
      <tr class="empty-state-row">
        <td colspan="3">
          <div class="empty-state">No variables yet</div>
        </td>
      </tr>
    `;return}const n={},s=[];t.forEach(c=>{const r=c.name.split("/");if(r.length>1){const i=r.slice(0,-1).join("/");n[i]||(n[i]=[]),n[i].push({...c,displayName:r[r.length-1]})}else s.push({...c,displayName:c.name})});const o=Object.keys(n).sort();let a="",l=0;s.forEach(c=>{a+=De(c,l++,!1)}),o.forEach(c=>{var u;const r=m.isGroupCollapsed(c),i=n[c].map(h=>h.id).join(","),d=((u=n[c][0])==null?void 0:u.resolvedType)||"STRING";a+=`
      <tr class="group-row ${r?"collapsed":""}" data-group="${p(c)}">
        <td colspan="3">
          <div class="group-header">
            <span class="group-toggle ${r?"collapsed":""}" onclick="window.app.toggleGroup('${p(c)}')">${P.chevronDown}</span>
            <span class="type-icon ${d}">${Xe(d)}</span>
            <span onclick="window.app.toggleGroup('${p(c)}')" style="flex:1;cursor:pointer;">
              ${p(c)}
              <span style="color:var(--text-dim);font-weight:400;font-size:10px;">(${n[c].length})</span>
            </span>
            <button class="row-action" onclick="window.app.openBulkEdit('${p(c)}')" title="Edit as text" style="opacity:0;">${P.edit}</button>
            <button class="row-action danger" onclick="window.app.deleteGroup('${i}')" title="Delete group" style="opacity:0;">${P.trash}</button>
          </div>
        </td>
      </tr>
    `,n[c].forEach(h=>{a+=De(h,l++,!0,r,c)})}),e.innerHTML=a}function De(e,t,n,s=!1,o=""){const a=s?"hidden-by-group":"",l=n?"grouped-item":"",c=o?`data-parent-group="${p(o)}"`:"";return`
    <tr data-id="${e.id}" class="${l} ${a}" ${c} draggable="true">
      <td>
        <div class="name-cell">
          <span class="drag-handle" title="Drag to reorder">${P.drag}</span>
          <span class="type-icon ${e.resolvedType}">${Xe(e.resolvedType)}</span>
          <input class="cell-input" value="${p(e.displayName)}"
            data-full-name="${p(e.name)}"
            onblur="window.app.updateNameFromDisplay('${e.id}', this.value, '${p(e.name)}')"
            onkeydown="window.app.handleKey(event, ${t}, 'name')">
        </div>
      </td>
      <td>
        ${ht(e)}
      </td>
      <td>
        <div class="row-actions">
          <button class="row-action" onclick="window.app.duplicateVariable('${e.id}')" title="Duplicate">${P.copy}</button>
          <button class="row-action danger" onclick="window.app.deleteVariable('${e.id}')" title="Delete">${P.trash}</button>
        </div>
      </td>
    </tr>
  `}function ht(e){if(e.resolvedType==="COLOR"){const t=e.value.match(/^\{(.+)\}$/);let n=e.value;if(t){const s=t[1],o=m.variables.find(a=>a.name===s);o&&o.resolvedType==="COLOR"?n=o.value:n="#888888"}return`
      <div class="color-value-cell">
        <div class="color-swatch" onclick="window.app.showColorValueMenu(event, '${e.id}', '${p(e.value)}')">
          <div class="color-swatch-inner" style="background:${p(n)}"></div>
        </div>
        <input class="cell-input mono" value="${p(e.value)}"
          onblur="window.app.updateValue('${e.id}', this.value)">
      </div>
    `}return e.resolvedType==="BOOLEAN"?`
      <div class="cell">
        <div class="bool-toggle">
          <button class="${e.value==="true"?"active":""}" onclick="window.app.updateValue('${e.id}', 'true')">True</button>
          <button class="${e.value==="false"?"active":""}" onclick="window.app.updateValue('${e.id}', 'false')">False</button>
        </div>
      </div>
    `:`
    <div class="value-cell">
      <input class="cell-input mono" value="${p(e.value)}"
        onblur="window.app.updateValue('${e.id}', this.value)">
    </div>
  `}function Ue(e){if(!e)return"#000000";if(e.startsWith("#"))return e;const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return t?"#"+[t[1],t[2],t[3]].map(n=>parseInt(n).toString(16).padStart(2,"0")).join(""):"#000000"}function xe(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?`rgb(${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)})`:e}function Q(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}function le(e){return"#"+[e.r,e.g,e.b].map(t=>Math.round(t).toString(16).padStart(2,"0")).join("")}function Be(e,t,n){t/=100,n/=100;const s=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),a=n*(1-t),l=n*(1-o*t),c=n*(1-(1-o)*t);let r,i,d;switch(s){case 0:r=n,i=c,d=a;break;case 1:r=l,i=n,d=a;break;case 2:r=a,i=n,d=c;break;case 3:r=a,i=l,d=n;break;case 4:r=c,i=a,d=n;break;default:r=n,i=a,d=l;break}return{r:Math.round(r*255),g:Math.round(i*255),b:Math.round(d*255)}}function ke(e,t,n){e/=255,t/=255,n/=255;const s=Math.max(e,t,n),o=Math.min(e,t,n),a=s-o;let l=0;const c=s===0?0:a/s,r=s;if(a!==0)switch(s){case e:l=((t-n)/a+(t<n?6:0))*60;break;case t:l=((n-e)/a+2)*60;break;case n:l=((e-t)/a+4)*60;break}return{h:l,s:c*100,v:r*100}}function gt(e,t){if(t<=50){const n=t/50,s={r:Math.round(255+(e.r-255)*n),g:Math.round(255+(e.g-255)*n),b:Math.round(255+(e.b-255)*n)};return le(s)}else{const n=(t-50)/50,s={r:Math.round(e.r*(1-n)),g:Math.round(e.g*(1-n)),b:Math.round(e.b*(1-n))};return le(s)}}function vt(e){if(e===5)return["100","300","500","700","900"];if(e===10)return["50","100","200","300","400","500","600","700","800","900"];if(e===11)return["50","100","200","300","400","500","600","700","800","900","950"];const t=[];for(let n=0;n<e;n++){const s=Math.round(50+n/(e-1)*900);t.push(String(s))}return t}let re=null,z=0,U=100,K=100,ye=!1,be=!1;function yt(){const e=document.getElementById("hue-slider"),t=document.getElementById("sv-panel"),n=document.getElementById("picker-hex-input");e&&(e.onmousedown=s=>{ye=!0,ze(s)}),t&&(t.onmousedown=s=>{be=!0,Re(s)}),document.addEventListener("mousemove",s=>{ye&&ze(s),be&&Re(s)}),document.addEventListener("mouseup",()=>{ye=!1,be=!1}),n&&(n.oninput=()=>{let s=n.value.trim();if(s.startsWith("#")||(s="#"+s),/^#[0-9a-fA-F]{6}$/.test(s)){const o=Q(s),a=ke(o.r,o.g,o.b);z=a.h,U=a.s,K=a.v,ue()}})}function ze(e){const t=document.getElementById("hue-slider");if(!t)return;const n=t.getBoundingClientRect();let s=(e.clientX-n.left)/n.width;s=Math.max(0,Math.min(1,s)),z=s*360,ue()}function Re(e){const t=document.getElementById("sv-panel");if(!t)return;const n=t.getBoundingClientRect();let s=(e.clientX-n.left)/n.width,o=(e.clientY-n.top)/n.height;s=Math.max(0,Math.min(1,s)),o=Math.max(0,Math.min(1,o)),U=s*100,K=(1-o)*100,ue()}function ue(){const e=document.getElementById("sv-panel"),t=document.getElementById("hue-handle"),n=document.getElementById("sv-handle"),s=document.getElementById("picker-hex-input");if(e){const o=`hsl(${z}, 100%, 50%)`;e.style.background=`linear-gradient(to right, #fff, ${o})`}if(t&&(t.style.left=`${z/360*100}%`),n&&(n.style.left=`${U}%`,n.style.top=`${100-K}%`),s){const o=Be(z,U,K);s.value=le(o)}}function bt(){const e=Be(z,U,K);return le(e)}function Ke(e,t){re=t;const n=e.startsWith("#")?e:Ue(e),s=Q(n),o=ke(s.r,s.g,s.b);z=o.h,U=o.s,K=o.v,ue();const a=document.getElementById("color-picker-modal");a&&a.classList.add("open")}function Qe(){const e=document.getElementById("color-picker-modal");e&&e.classList.remove("open"),re=null}function wt(){const e=bt();re&&re(e),Qe()}function X(){return{startValue:0,handle1:{t:.25,value:0},handle2:{t:.75,value:0},endValue:0}}let F=X(),q=X(),Y=X(),k=null;const Et=5,It=90;function $(e,t,n){return Math.max(t,Math.min(n,e))}function te(){return{lightValue:Et,darkValue:It}}function Je(e,t){const n=t/e,s=n/2,o=t-n/2;return{swatchWidth:n,firstNodeX:s,lastNodeX:o,rangeX:Math.max(1,o-s)}}function xt(e){const t=document.getElementById("shades-base-color"),n=t==null?void 0:t.value;if(!n)return Array.from({length:e},()=>"var(--bg)");const{lightValue:s,darkValue:o}=te(),a=Q(n),l=S(F,e),c=S(q,e),r=S(Y,e);return fe(s,o,a,e,l,c,r)}function Bt(){const e=document.getElementById("shades-btn"),t=document.getElementById("shades-modal");e&&(e.onclick=kt),t&&(t.onclick=n=>{n.target===t&&pe()})}function kt(){Ct(),$t();const e=document.getElementById("shades-modal");e&&e.classList.add("open")}function $t(){const e={name:document.getElementById("shades-name"),baseColor:document.getElementById("shades-base-color"),baseHex:document.getElementById("shades-base-hex"),basePreview:document.getElementById("shades-base-preview"),count:document.getElementById("shades-count"),options:document.getElementById("shades-options"),generateBtn:document.getElementById("shades-generate-btn"),removeBtn:document.getElementById("shades-remove-btn"),curveProperty:document.getElementById("shades-curve-property")};e.name&&(e.name.value=""),e.baseColor&&(e.baseColor.value=""),e.baseHex&&(e.baseHex.value=""),e.basePreview&&(e.basePreview.style.background="transparent"),e.count&&(e.count.value="11"),e.options&&(e.options.style.display="none"),e.generateBtn&&(e.generateBtn.style.display="none"),e.removeBtn&&(e.removeBtn.style.display="none"),e.curveProperty&&(e.curveProperty.value="lightness"),F=X(),q=X(),Y=X(),_e()}function _e(){const e=document.getElementById("shades-preview");e&&(e.innerHTML='<div style="color:var(--text-dim);font-size:11px;padding:8px;text-align:center;">Pick a color to preview shades</div>')}function Ct(){const e=document.getElementById("shades-source");if(!e)return;const t=m.variables.filter(a=>a.collectionId===m.selectedCollectionId&&a.resolvedType==="COLOR"),n={},s=[];t.forEach(a=>{if(a.name.includes("/")){const l=a.name.split("/")[0];n[l]||(n[l]=[]),n[l].push(a)}else s.push(a)});let o='<option value="">-- Pick a color manually --</option>';s.forEach(a=>{o+=`<option value="single:${a.id}" data-color="${p(a.value)}" data-name="${p(a.name)}" data-type="single">${p(a.name)}</option>`}),Object.keys(n).sort().forEach(a=>{const l=n[a],c=Math.floor(l.length/2),r=l[c],i=l.map(d=>d.id).join(",");o+=`<option value="group:${a}" data-color="${p(r.value)}" data-name="${p(a)}" data-type="group" data-count="${l.length}" data-ids="${i}">${p(a)} (${l.length} shades)</option>`}),e.innerHTML=o}function Lt(){const e=document.getElementById("shades-source"),t=document.getElementById("shades-options"),n=document.getElementById("shades-generate-btn"),s=document.getElementById("shades-remove-btn");if(!e||!t||!n||!s)return;const o=e.selectedOptions[0];if(!o||!o.value){t.style.display="none",n.style.display="none",s.style.display="none";return}t.style.display="flex",n.style.display="block";const a=o.dataset.color||"",l=o.dataset.name||"",c=o.dataset.type,r=document.getElementById("shades-name");r&&(r.value=l);const i=Ue(a),d=document.getElementById("shades-base-color"),u=document.getElementById("shades-base-hex"),h=document.getElementById("shades-base-preview");if(d&&(d.value=i),u&&(u.value=i),h&&(h.style.background=i),c==="group"){const v=parseInt(o.dataset.count||"11"),y=document.getElementById("shades-count");y&&(y.value=String(v)),n.textContent="Update Shades",s.style.display="block"}else n.textContent="Generate",s.style.display="none";ne()}function Mt(){const e=document.getElementById("shades-base-hex"),t=document.getElementById("shades-base-color"),n=document.getElementById("shades-base-preview");if(!e||!t)return;let s=e.value.trim();s.startsWith("#")||(s="#"+s),/^#[0-9a-fA-F]{6}$/.test(s)&&(t.value=s,n&&(n.style.background=s),ne())}function ne(){const e=document.getElementById("shades-base-color"),t=e==null?void 0:e.value;if(!t){_e();return}const n=document.getElementById("shades-count"),s=document.getElementById("shades-curve-property"),{lightValue:o,darkValue:a}=te(),l=parseInt((n==null?void 0:n.value)||"11");s!=null&&s.value;const c=document.getElementById("shades-base-preview"),r=document.getElementById("shades-base-hex");c&&(c.style.background=t),r&&(r.value=t);const i=Q(t),d=S(F,l),u=S(q,l),h=S(Y,l),v=fe(o,a,i,l,d,u,h),y=document.getElementById("shades-preview");y&&(y.innerHTML=v.map(g=>`<div class="shades-preview-item" style="background:${g}" title="${g}"></div>`).join("")),et()}function pe(){const e=document.getElementById("shades-modal");e&&e.classList.remove("open")}function St(){const e=document.getElementById("shades-name"),t=document.getElementById("shades-base-color"),n=e==null?void 0:e.value.trim(),s=t==null?void 0:t.value;if(!s){alert("Please pick a base color");return}if(!n){alert("Please enter a group name");return}const o=document.getElementById("shades-source"),a=o==null?void 0:o.selectedOptions[0],l=a&&a.dataset.type==="group",c=a&&a.dataset.type==="single";let r=[];l&&a.dataset.ids?r=a.dataset.ids.split(","):c&&a.value&&(r=[a.value.replace("single:","")]);const i=document.getElementById("shades-count"),d=document.getElementById("shades-curve-property"),{lightValue:u,darkValue:h}=te(),v=parseInt((i==null?void 0:i.value)||"11");d!=null&&d.value;const y=Q(s),g=S(F,v),A=S(q,v),B=S(Y,v),T=fe(u,h,y,v,g,A,B),O=vt(v),oe=T.map((I,ae)=>({name:`${n}/${O[ae]}`,value:xe(I)}));r.length>0?E({type:"update-shades",collectionId:m.selectedCollectionId,deleteIds:r,shades:oe}):E({type:"create-shades",collectionId:m.selectedCollectionId,shades:oe}),pe()}function Tt(){var l;const e=document.getElementById("shades-source"),t=e==null?void 0:e.selectedOptions[0];if(!t||t.dataset.type!=="group")return;const n=t.dataset.name,s=((l=t.dataset.ids)==null?void 0:l.split(","))||[],o=document.getElementById("shades-base-color"),a=o==null?void 0:o.value;confirm(`Convert "${n}" shades back to a single color?`)&&(E({type:"remove-shades",collectionId:m.selectedCollectionId,deleteIds:s,newColor:{name:n,value:xe(a)}}),pe())}function Vt(){const e=document.getElementById("shades-base-color"),t=(e==null?void 0:e.value)||"#000000";Ke(t,n=>{const s=document.getElementById("shades-base-color"),o=document.getElementById("shades-base-hex"),a=document.getElementById("shades-base-preview");s&&(s.value=n),o&&(o.value=n),a&&(a.style.background=n),ne()})}function me(e){switch(e){case"saturation":return q;case"hue":return Y;default:return F}}function At(e,t){switch(e){case"saturation":q=t;break;case"hue":Y=t;break;default:F=t;break}}function Ze(e,t,n,s,o){const a=1-o;return a*a*a*e+3*a*a*o*t+3*a*o*o*n+o*o*o*s}function Ht(e,t,n,s,o){const a=1-o;return 3*a*a*(t-e)+6*a*o*(n-t)+3*o*o*(s-n)}function Pt(e,t,n){let s=$(e,0,1);for(let o=0;o<5;o++){const l=Ze(0,t,n,1,s)-e;if(Math.abs(l)<1e-4)break;const c=Ht(0,t,n,1,s);if(c===0)break;s=$(s-l/c,0,1)}return s}function Ot(e,t){const n=e.startValue,s=e.handle1.value,o=e.handle2.value,a=e.endValue,l=$(e.handle1.t,0,1),c=$(e.handle2.t,0,1),r=Pt(t,l,c);return Ze(n,s,o,a,r)}function S(e,t){const n=[];for(let s=0;s<t;s++){const o=s/(t-1);n.push(Ot(e,o))}return n}function jt(){ne()}function et(){const e=document.getElementById("shades-curve-svg"),t=document.getElementById("shades-curve-editor"),n=document.getElementById("shades-curve-property"),s=document.getElementById("shades-count");if(!e||!t)return;const o=(n==null?void 0:n.value)||"lightness",a=me(o),l=parseInt((s==null?void 0:s.value)||"11");if(l<2)return;const c=t.offsetWidth||300,r=100,i=8,d=6;e.setAttribute("viewBox",`0 0 ${c} ${r}`),e.style.width=c+"px",e.style.height=r+"px";const{swatchWidth:u,firstNodeX:h,rangeX:v}=Je(l,c),y=r/2,g=r-10,A=10;let B="";for(let w=0;w<=l;w++){const x=w*u;B+=`<line x1="${x}" y1="0" x2="${x}" y2="${r}" stroke="var(--border)" stroke-width="1" opacity="0.35"/>`}B+=`<line x1="0" y1="${y}" x2="${c}" y2="${y}" stroke="var(--border)" stroke-width="1" stroke-dasharray="4,4" opacity="0.3"/>`;const{lightValue:T,darkValue:O}=te(),oe=S(a,l),I=[];for(let w=0;w<l;w++){const x=w/(l-1),W=h+v*x,N=T+(O-T)*x,V=oe[w],J=Math.max(0,Math.min(100,N+V)),ve=g-J/100*(g-A);I.push({x:W,y:ve,value:J})}const ae=I[0],Ve=I[l-1],Ae=$(a.handle1.t,0,1),at=T+(O-T)*Ae,lt=Math.max(0,Math.min(100,at+a.handle1.value)),He=h+v*Ae,Pe=$(g-lt/100*(g-A),A,g),Oe=$(a.handle2.t,0,1),rt=T+(O-T)*Oe,ct=Math.max(0,Math.min(100,rt+a.handle2.value)),je=h+v*Oe,Ne=$(g-ct/100*(g-A),A,g);if(I.length>1){let w=`M ${I[0].x} ${I[0].y}`;for(let x=0;x<I.length-1;x++){const W=I[Math.max(0,x-1)],N=I[x],V=I[x+1],J=I[Math.min(I.length-1,x+2)],ve=N.x+(V.x-W.x)/6,dt=N.y+(V.y-W.y)/6,ut=V.x-(J.x-N.x)/6,pt=V.y-(J.y-N.y)/6;w+=` C ${ve} ${dt}, ${ut} ${pt}, ${V.x} ${V.y}`}B+=`<path d="${w}" fill="none" stroke="var(--accent)" stroke-width="2"/>`}B+=`<line x1="${ae.x}" y1="${ae.y}" x2="${He}" y2="${Pe}" stroke="var(--text-dim)" stroke-width="1"/>`,B+=`<line x1="${Ve.x}" y1="${Ve.y}" x2="${je}" y2="${Ne}" stroke="var(--text-dim)" stroke-width="1"/>`,B+=`<circle cx="${He}" cy="${Pe}" r="${d}" fill="var(--text)" class="curve-handle" data-target="handle1" style="cursor:ew-resize;"/>`,B+=`<circle cx="${je}" cy="${Ne}" r="${d}" fill="var(--text)" class="curve-handle" data-target="handle2" style="cursor:ew-resize;"/>`;const it=xt(l);I.forEach((w,x)=>{const W=x===0||x===I.length-1,N=x===0?"startNode":x===I.length-1?"endNode":"",V=it[x]||"var(--bg)";W?B+=`<circle cx="${w.x}" cy="${w.y}" r="${i}" fill="${V}" stroke="var(--accent)" stroke-width="2" class="curve-node-draggable" data-target="${N}" style="cursor:ns-resize;"/>`:B+=`<circle cx="${w.x}" cy="${w.y}" r="${i}" fill="${V}" stroke="var(--accent)" stroke-width="2"/>`}),e.innerHTML=B,e.querySelectorAll(".curve-handle").forEach(w=>{w.addEventListener("mousedown",Nt)}),e.querySelectorAll(".curve-node-draggable").forEach(w=>{w.addEventListener("mousedown",Dt)})}function Nt(e){const t=e,s=t.target.dataset.target,o=document.getElementById("shades-curve-property"),a=(o==null?void 0:o.value)||"lightness",l=me(a),c=s==="handle1"?l.handle1.value:l.handle2.value,r=s==="handle1"?l.handle1.t:l.handle2.t;k={startX:t.clientX,startY:t.clientY,startValue:c,startT:r,property:a,target:s},document.addEventListener("mousemove",$e),document.addEventListener("mouseup",Ce),e.preventDefault()}function Dt(e){const t=e,s=t.target.dataset.target,o=document.getElementById("shades-curve-property"),a=(o==null?void 0:o.value)||"lightness",l=me(a),c=s==="startNode"?l.startValue:l.endValue;k={startX:t.clientX,startY:t.clientY,startValue:c,startT:s==="startNode"?0:1,property:a,target:s},document.addEventListener("mousemove",$e),document.addEventListener("mouseup",Ce),e.preventDefault()}function $e(e){if(!k||!document.getElementById("shades-curve-svg"))return;const a=100-10-10,l=me(k.property),c={...l};if(k.target==="handle1"||k.target==="handle2"){const r=document.getElementById("shades-curve-editor"),i=document.getElementById("shades-count"),d=parseInt((i==null?void 0:i.value)||"11"),u=(r==null?void 0:r.offsetWidth)||300,{rangeX:h}=Je(d,u),v=e.clientX-k.startX,y=.05;let g=k.startT+v/h;const B=(k.startY-e.clientY)/a*100,T=$(k.startValue+B,-50,50);if(k.target==="handle1"){const O=$(l.handle2.t-y,0,1-y);g=$(g,0,O),c.handle1={...l.handle1,t:g,value:T}}else{const O=$(l.handle1.t+y,y,1);g=$(g,O,1),c.handle2={...l.handle2,t:g,value:T}}}else{const i=(k.startY-e.clientY)/a*100,d=$(k.startValue+i,-50,50);k.target==="startNode"?c.startValue=d:c.endValue=d}At(k.property,c),et(),zt()}function Ce(){k=null,document.removeEventListener("mousemove",$e),document.removeEventListener("mouseup",Ce)}function zt(){const e=document.getElementById("shades-base-color"),t=e==null?void 0:e.value;if(!t)return;const n=document.getElementById("shades-count"),{lightValue:s,darkValue:o}=te(),a=parseInt((n==null?void 0:n.value)||"11"),l=Q(t),c=S(F,a),r=S(q,a),i=S(Y,a),d=fe(s,o,l,a,c,r,i),u=document.getElementById("shades-preview");u&&(u.innerHTML=d.map(h=>`<div class="shades-preview-item" style="background:${h}" title="${h}"></div>`).join(""))}function fe(e,t,n,s,o,a,l){const c=[],r=ke(n.r,n.g,n.b);for(let i=0;i<s;i++){const d=i/(s-1),u=e+(t-e)*d,h=Math.max(0,Math.min(100,u+(o[i]||0))),v=Math.max(0,Math.min(100,r.s+(a[i]||0))),y=(r.h+(l[i]||0)+360)%360,g=Be(y,v,r.v);c.push(gt(g,h))}return c}const Rt={tshirt:{steps:"xs, sm, md, lg, xl, 2xl, 3xl",baseStep:"md"},numeric:{steps:"1, 2, 3, 4, 5, 6, 7, 8, 9, 10",baseStep:"5"},gutenberg:{steps:"xs, sm, base, md, lg, giga, mega, ultra",baseStep:"base"}};function Ft(){const e=document.getElementById("steps-btn"),t=document.getElementById("steps-modal");e&&(e.onclick=qt),t&&(t.onclick=n=>{n.target===t&&he()})}function qt(){Gt(),Yt();const e=document.getElementById("steps-modal");e&&e.classList.add("open"),G()}function Yt(){const e={options:document.getElementById("steps-options"),name:document.getElementById("steps-name"),baseValue:document.getElementById("steps-base-value"),ratioPreset:document.getElementById("steps-ratio-preset"),ratioCustom:document.getElementById("steps-ratio-custom"),stepsListPreset:document.getElementById("steps-list-preset"),stepsList:document.getElementById("steps-list"),generateBtn:document.getElementById("steps-generate-btn"),removeBtn:document.getElementById("steps-remove-btn")};e.options&&(e.options.style.display="none"),e.name&&(e.name.value=""),e.baseValue&&(e.baseValue.value="16"),e.ratioPreset&&(e.ratioPreset.value="1.25"),e.ratioCustom&&(e.ratioCustom.value="1.25",e.ratioCustom.disabled=!0),e.stepsListPreset&&(e.stepsListPreset.value="tshirt"),e.stepsList&&(e.stepsList.value="xs, sm, md, lg, xl, 2xl, 3xl"),e.generateBtn&&(e.generateBtn.textContent="Generate"),e.removeBtn&&(e.removeBtn.style.display="none"),Le("md")}function Gt(){const e=document.getElementById("steps-source");if(!e)return;const t=m.variables.filter(a=>a.collectionId===m.selectedCollectionId&&a.resolvedType==="FLOAT"),n={},s=[];t.forEach(a=>{if(a.name.includes("/")){const l=a.name.split("/")[0];n[l]||(n[l]=[]),n[l].push(a)}else s.push(a)});let o='<option value="">-- Create new scale --</option>';s.forEach(a=>{o+=`<option value="single:${a.id}" data-value="${p(a.value)}" data-name="${p(a.name)}" data-type="single">${p(a.name)} (${a.value})</option>`}),Object.keys(n).sort().forEach(a=>{const l=n[a],c=Math.floor(l.length/2),r=l[c],i=l.map(d=>d.id).join(",");o+=`<option value="group:${a}" data-value="${p(r.value)}" data-name="${p(a)}" data-type="group" data-count="${l.length}" data-ids="${i}">${p(a)} (${l.length} steps)</option>`}),e.innerHTML=o}function Wt(){const e=document.getElementById("steps-source"),t=document.getElementById("steps-options"),n=document.getElementById("steps-generate-btn"),s=document.getElementById("steps-remove-btn");if(!e||!t||!n||!s)return;const o=e.selectedOptions[0];if(!o||!o.value){t.style.display="none",n.textContent="Generate",s.style.display="none";return}t.style.display="flex";const a=o.dataset.name||"",l=o.dataset.value||"16",c=o.dataset.type,r=document.getElementById("steps-name"),i=document.getElementById("steps-base-value");r&&(r.value=a),c==="group"?(n.textContent="Update Steps",s.style.display="block",Xt(a)):(i&&(i.value=l),n.textContent="Generate",s.style.display="none"),G()}function Xt(e){const t=document.getElementById("steps-base-step"),n=document.getElementById("steps-base-value"),s=document.getElementById("steps-list");if(!t||!n||!s)return;const o=m.variables.filter(r=>r.collectionId===m.selectedCollectionId&&r.name.startsWith(e+"/"));if(o.length===0)return;const a=o.map(r=>({name:r.name.split("/").pop()||"",value:r.value}));s.value=a.map(r=>r.name).join(", ");let l="";a.forEach(r=>{l+=`<option value="${p(r.name)}">${p(r.name)}</option>`}),t.innerHTML=l;const c=Math.floor(a.length/2);t.selectedIndex=c,n&&a[c]&&(n.value=a[c].value)}function Ut(){const e=document.getElementById("steps-ratio-preset"),t=document.getElementById("steps-ratio-custom");if(!e||!t)return;const n=e.value;n==="custom"?(t.disabled=!1,t.focus()):(t.value=n,t.disabled=!0),G()}function Le(e){const t=document.getElementById("steps-base-step"),n=document.getElementById("steps-list");if(!t||!n)return;const s=n.value.split(",").map(a=>a.trim()).filter(a=>a);let o="";if(s.forEach(a=>{const l=a===e?" selected":"";o+=`<option value="${p(a)}"${l}>${p(a)}</option>`}),t.innerHTML=o,e&&!s.includes(e)&&s.length>0){const a=Math.floor(s.length/2);t.value=s[a]}}function Kt(){G()}function Qt(){const e=document.getElementById("steps-list-preset"),t=document.getElementById("steps-list");if(!e||!t)return;const n=e.value,s=Rt[n];s&&(t.value=s.steps,Le(s.baseStep)),G()}function Jt(){const e=document.getElementById("steps-list-preset");e&&(e.value="custom");const t=document.getElementById("steps-base-step"),n=t==null?void 0:t.value;Le(n),G()}function he(){const e=document.getElementById("steps-modal");e&&e.classList.remove("open")}function G(){const e=document.getElementById("steps-base-value"),t=document.getElementById("steps-base-step"),n=document.getElementById("steps-ratio-custom"),s=document.getElementById("steps-list"),o=document.getElementById("steps-preview");if(!e||!t||!n||!s||!o)return;const a=parseFloat(e.value)||16,l=t.value||"",c=parseFloat(n.value)||1.25,r=s.value.split(",").map(u=>u.trim()).filter(u=>u);if(r.length===0){o.innerHTML='<div style="color:var(--text-dim);font-size:11px;padding:8px;text-align:center;">Enter step names</div>';return}const i=r.indexOf(l);if(i===-1){o.innerHTML='<div style="color:var(--text-dim);font-size:11px;padding:8px;text-align:center;">Select a base step</div>';return}const d=r.map((u,h)=>{const v=h-i,y=a*Math.pow(c,v);return{step:u,value:Math.round(y)}});o.innerHTML=`
    <div class="steps-preview-list">
      ${d.map(({step:u,value:h})=>`
        <div class="steps-preview-item ${u===l?"base":""}">
          <span class="step-name">${p(u)}</span>
          <span class="step-value">${h}</span>
        </div>
      `).join("")}
    </div>
  `}function _t(){const e=document.getElementById("steps-list");return e?e.value.split(",").map(t=>t.trim()).filter(t=>t):[]}function Zt(){const e=document.getElementById("steps-base-value"),t=document.getElementById("steps-base-step"),n=document.getElementById("steps-ratio-custom"),s=parseFloat((e==null?void 0:e.value)||"16"),o=(t==null?void 0:t.value)||"",a=parseFloat((n==null?void 0:n.value)||"1.25"),l=_t(),c=l.indexOf(o);return c===-1?[]:l.map((r,i)=>{const d=i-c,u=s*Math.pow(a,d);return{step:r,value:Math.round(u)}})}function en(){const e=document.getElementById("steps-name"),t=e==null?void 0:e.value.trim();if(!t){alert("Please enter a group name");return}const n=Zt();if(n.length===0){alert("Please check your step configuration");return}const s=document.getElementById("steps-source"),o=s==null?void 0:s.selectedOptions[0],a=o&&o.dataset.type==="group",l=o&&o.dataset.type==="single";let c=[];a&&o.dataset.ids?c=o.dataset.ids.split(","):l&&o.value&&(c=[o.value.replace("single:","")]);const r=n.map(({step:i,value:d})=>({name:`${t}/${i}`,value:String(d)}));c.length>0?E({type:"update-steps",collectionId:m.selectedCollectionId,deleteIds:c,steps:r}):E({type:"create-steps",collectionId:m.selectedCollectionId,steps:r}),he()}function tn(){var i;const e=document.getElementById("steps-source"),t=e==null?void 0:e.selectedOptions[0];if(!t||t.dataset.type!=="group")return;const n=t.dataset.name||"",s=((i=t.dataset.ids)==null?void 0:i.split(","))||[],o=document.getElementById("steps-base-step"),a=(o==null?void 0:o.value)||"",l=`${n}/${a}`,c=m.variables.find(d=>d.name===l),r=(c==null?void 0:c.value)||"16";confirm(`Convert "${n}" steps back to a single number?`)&&(E({type:"remove-steps",collectionId:m.selectedCollectionId,deleteIds:s,newNumber:{name:n,value:r}}),he())}let ce=null;function nn(){const e=document.getElementById("input-modal"),t=document.getElementById("input-modal-input"),n=document.getElementById("input-modal-select"),s=document.getElementById("input-modal-confirm");s&&(s.onclick=()=>{let o="";t.style.display!=="none"?o=t==null?void 0:t.value.trim():o=n==null?void 0:n.value,o&&ce&&ce(o),_()}),t&&(t.onkeydown=o=>{o.key==="Enter"?s==null||s.click():o.key==="Escape"&&_()}),n&&(n.onkeydown=o=>{o.key==="Enter"?s==null||s.click():o.key==="Escape"&&_()}),e&&(e.onclick=o=>{o.target===e&&_()})}function tt(e,t,n,s,o){const a=document.getElementById("input-modal-title"),l=document.getElementById("input-modal-label"),c=document.getElementById("input-modal-confirm"),r=document.getElementById("input-modal-input"),i=document.getElementById("input-modal-select"),d=document.getElementById("input-modal");a&&(a.textContent=e),l&&(l.textContent=t),c&&(c.textContent=n),r.style.display="block",i.style.display="none",r.value="",ce=s,d&&d.classList.add("open"),setTimeout(()=>{r==null||r.focus()},50)}function _(){const e=document.getElementById("input-modal");e&&e.classList.remove("open"),ce=null}function sn(){document.querySelectorAll("[data-icon]").forEach(e=>{const t=e.dataset.icon;if(t)if(t.startsWith("type-")){const n=t.replace("type-","");e.innerHTML=We[n]||""}else e.innerHTML=P[t]||""})}let b=-1,C="name",R=!1;function on(){sn(),yt(),Bt(),Ft(),nn(),mn(),an(),ln(),kn(),rn(),cn(),dn(),wn(),En(),window.app={showAddMenu:nt,showColorValueMenu:un,toggleGroup:$n,deleteGroup:Cn,deleteVariable:gn,duplicateVariable:vn,updateNameFromDisplay:Ln,updateValue:Te,handleKey:Mn,openColorPickerForVariable:ot,closeColorReferenceModal:ge,filterColorReferences:fn,handleColorReferenceSearchKey:hn,selectSourceColor:Lt,updateBaseFromHex:Mt,updateShadesPreview:ne,closeShadesModal:pe,generateShades:St,removeShades:Tt,openShadesColorPicker:Vt,updateCurveEditor:jt,selectSourceNumber:Wt,selectRatioPreset:Ut,selectStepsPreset:Qt,onStepsListInput:Jt,onBaseStepChange:Kt,updateStepsPreview:G,closeStepsModal:he,generateSteps:en,removeSteps:tn,openBulkEdit:yn,closeBulkEdit:Se,applyBulkEdit:bn,closeColorPicker:Qe,confirmColorPicker:wt,closeInputModal:_}}function an(){document.querySelectorAll(".tab").forEach(e=>{e.onclick=()=>{var n;document.querySelectorAll(".tab").forEach(s=>s.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(s=>s.classList.remove("active")),e.classList.add("active");const t=e.dataset.tab+"-tab";(n=f(`${t}`))==null||n.classList.add("active"),e.dataset.tab==="json"&&st()}})}function ln(){const e=f("refresh-btn"),t=f("add-collection-btn"),n=f("expand-btn"),s=f("search-input");e&&(e.onclick=()=>E({type:"refresh"})),t&&(t.onclick=()=>{tt("New Collection","Collection name","Create",o=>{E({type:"create-collection",name:o})})}),n&&(n.onclick=Bn),s&&(s.oninput=()=>{m.setSearchQuery(s.value),ee(),ie()},s.onkeydown=o=>{o.key==="Escape"&&(s.value="",m.setSearchQuery(""),ee(),ie())})}function ie(){const e=f("search-count");if(!e)return;const{shown:t,total:n}=m.getFilteredCount();m.searchQuery?e.textContent=`${t}/${n}`:e.textContent=""}function rn(){const e=f("collection-select");e&&(e.onchange=()=>{m.selectedCollectionId=e.value,ee(),ie()})}const L=f("add-menu");function cn(){const e=f("add-variable-btn");e&&(e.onclick=nt),document.addEventListener("click",t=>{const n=t.target;!n.closest("#add-menu")&&!n.closest("#add-variable-btn")&&!n.closest(".add-row-btn")&&(L==null||L.classList.remove("open"))}),L==null||L.querySelectorAll("button").forEach(t=>{t.onclick=()=>{const n=t.dataset.type;L==null||L.classList.remove("open"),tt("New Variable","Variable name","Create",s=>{let o="";n==="COLOR"?o="rgb(0, 0, 0)":n==="FLOAT"?o="0":n==="BOOLEAN"&&(o="true"),E({type:"create-variable",collectionId:m.selectedCollectionId,name:s,varType:n,value:o})})}})}function nt(e){const n=e.target.getBoundingClientRect();L&&(L.style.top=n.bottom+4+"px",L.style.left=n.left+"px",L.classList.add("open"))}const M=f("color-value-menu");let de="",Me="";function dn(){document.addEventListener("click",e=>{const t=e.target;!t.closest("#color-value-menu")&&!t.closest(".color-swatch")&&(M==null||M.classList.remove("open"))}),M==null||M.querySelectorAll("button").forEach(e=>{e.onclick=()=>{const t=e.dataset.action;M==null||M.classList.remove("open"),t==="pick"?ot(de,Me):t==="reference"&&pn()}})}function un(e,t,n){e.stopPropagation();const o=e.target.closest(".color-swatch");if(!o)return;const a=o.getBoundingClientRect();de=t,Me=n,M&&(M.style.top=a.bottom+4+"px",M.style.left=a.left+"px",M.classList.add("open"))}function pn(){const e=m.variables.filter(r=>r.resolvedType==="COLOR"&&r.id!==de);if(e.length===0){alert("No other color variables available to reference");return}const t={},n=[];e.forEach(r=>{const i=r.name.split("/");if(i.length>1){const d=i.slice(0,-1).join("/");t[d]||(t[d]=[]),t[d].push(r)}else n.push(r)});const s=f("color-reference-list");if(!s)return;let o="";n.length>0&&(o+='<div class="color-reference-group" data-group="">',Object.keys(t).length>0&&(o+='<div class="color-reference-group-header">Variables</div>'),n.forEach(r=>{o+=Fe(r)}),o+="</div>"),Object.keys(t).sort().forEach(r=>{o+=`<div class="color-reference-group" data-group="${p(r)}">`,o+=`<div class="color-reference-group-header">${p(r)}</div>`,t[r].forEach(i=>{o+=Fe(i)}),o+="</div>"}),s.innerHTML=o,s.querySelectorAll(".color-reference-item").forEach(r=>{r.addEventListener("click",()=>{const i=r.dataset.name;i&&(Te(de,`{${i}}`),ge())})});const a=Me.match(/^\{(.+)\}$/);if(a){const r=a[1],i=s.querySelector(`.color-reference-item[data-name="${r}"]`);i&&(i.classList.add("selected"),setTimeout(()=>{i.scrollIntoView({block:"center",behavior:"smooth"})},100))}const l=f("color-reference-modal");l&&l.classList.add("open");const c=f("color-reference-search");c&&(c.value="",setTimeout(()=>c.focus(),50))}function Fe(e){const t=e.name.includes("/")?e.name.split("/").pop():e.name,n=e.value.match(/^\{(.+)\}$/);let s=e.value;if(n){const o=n[1],a=m.variables.find(l=>l.name===o);a&&a.resolvedType==="COLOR"?s=a.value:s="#888888"}return`
    <div class="color-reference-item" data-name="${p(e.name)}" data-search="${p(e.name.toLowerCase())}">
      <div class="color-reference-swatch">
        <div class="color-reference-swatch-inner" style="background:${p(s)}"></div>
      </div>
      <span class="color-reference-name">${p(t)}</span>
    </div>
  `}function ge(){const e=f("color-reference-modal");e&&e.classList.remove("open")}function mn(){const e=f("color-reference-modal");e&&(e.onclick=t=>{t.target===e&&ge()})}function fn(e){const t=f("color-reference-list");if(!t)return;const n=e.toLowerCase(),s=t.querySelectorAll(".color-reference-item"),o=t.querySelectorAll(".color-reference-group");s.forEach(a=>{(a.dataset.search||"").includes(n)?a.classList.remove("hidden"):a.classList.add("hidden")}),o.forEach(a=>{a.querySelectorAll(".color-reference-item:not(.hidden)").length===0?a.classList.add("hidden"):a.classList.remove("hidden")})}function hn(e){if(e.key==="Enter"){const t=f("color-reference-list"),n=t==null?void 0:t.querySelector(".color-reference-item:not(.hidden)");n&&n.click()}else e.key==="Escape"&&ge()}function gn(e){confirm("Delete this variable?")&&E({type:"delete-variable",id:e})}function vn(e){E({type:"duplicate-variable",id:e})}let D="";function yn(e){D=e;const t=f("bulk-edit-modal"),n=f("bulk-edit-group-name"),s=f("bulk-edit-textarea"),o=f("bulk-edit-preview");if(!t||!s)return;const l=m.variables.filter(c=>c.collectionId===m.selectedCollectionId&&c.name.startsWith(e+"/")).map(c=>`${c.name.replace(e+"/","")}, ${c.value}`);n&&(n.textContent=e),s.value=l.join(`
`),o&&(o.innerHTML=""),t.classList.add("open"),s.focus(),s.oninput=()=>qe(),s.onkeydown=c=>{c.key==="Escape"&&Se()},qe()}function Se(){const e=f("bulk-edit-modal");e&&e.classList.remove("open"),D=""}function qe(){const e=f("bulk-edit-textarea"),t=f("bulk-edit-preview");if(!e||!t)return;const n=e.value.split(`
`).filter(l=>l.trim()),s=m.variables.filter(l=>l.collectionId===m.selectedCollectionId&&l.name.startsWith(D+"/")),o=new Set(s.map(l=>l.name.replace(D+"/","")));let a="";n.forEach(l=>{const[c,...r]=l.split(/[,\t]/),i=c==null?void 0:c.trim(),d=r.join(",").trim();if(!i)return;const u=!o.has(i),h=s.find(B=>B.name===D+"/"+i),v=h&&h.value!==d,y=u?"new":v?"modified":"",g=u?"new":v?"modified":"",A=d.startsWith("#")||d.startsWith("rgb")||d.startsWith("{");a+=`
      <div class="bulk-edit-preview-item">
        ${A?`<div class="preview-swatch" style="background:${d.startsWith("{")?"#888":d}"></div>`:""}
        <span class="preview-name">${D}/${i}</span>
        <span class="preview-value">${d}</span>
        ${g?`<span class="preview-status ${y}">${g}</span>`:""}
      </div>
    `}),t.innerHTML=a}function bn(){const e=f("bulk-edit-textarea");if(!e)return;const t=e.value.split(`
`).filter(s=>s.trim()),n=[];t.forEach(s=>{const[o,...a]=s.split(/[,\t]/),l=o==null?void 0:o.trim(),c=a.join(",").trim();l&&c&&n.push({name:D+"/"+l,value:c})}),n.length>0&&E({type:"bulk-update-group",collectionId:m.selectedCollectionId,groupName:D,updates:n}),Se()}let j=null;function wn(){const e=f("table-body");e&&(e.addEventListener("dragstart",t=>{const s=t.target.closest("tr[data-id]");s&&(j=s,s.classList.add("dragging"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s.dataset.id||"")))}),e.addEventListener("dragover",t=>{if(t.preventDefault(),!j)return;const s=t.target.closest("tr[data-id]");if(!s||s===j)return;e.querySelectorAll(".drag-over, .drag-over-below").forEach(l=>{l.classList.remove("drag-over","drag-over-below")});const o=s.getBoundingClientRect(),a=o.top+o.height/2;t.clientY<a?s.classList.add("drag-over"):s.classList.add("drag-over-below")}),e.addEventListener("dragleave",t=>{const s=t.target.closest("tr[data-id]");s&&s.classList.remove("drag-over","drag-over-below")}),e.addEventListener("drop",t=>{if(t.preventDefault(),!j)return;const s=t.target.closest("tr[data-id]");if(!s||s===j)return;const o=j.dataset.id,a=s.dataset.id,l=s.classList.contains("drag-over");e.querySelectorAll(".drag-over, .drag-over-below").forEach(c=>{c.classList.remove("drag-over","drag-over-below")}),o&&a&&E({type:"reorder-variable",draggedId:o,targetId:a,insertBefore:l})}),e.addEventListener("dragend",()=>{j&&(j.classList.remove("dragging"),j=null),e.querySelectorAll(".drag-over, .drag-over-below").forEach(t=>{t.classList.remove("drag-over","drag-over-below")})}))}function En(){const e=document.querySelector(".table-container");e&&(e.setAttribute("tabindex","0"),e.addEventListener("keydown",In),e.addEventListener("click",t=>{const s=t.target.closest(".cell-input");if(s){const o=s.closest("tr[data-id]");if(o){const a=se(),l=Array.from(a).indexOf(o);l>=0&&(b=l,C=s.closest(".name-cell")?"name":"value",R=!0,H())}}}),e.addEventListener("focusout",t=>{t.target.classList.contains("cell-input")&&setTimeout(()=>{const s=document.activeElement;(!s||!s.classList.contains("cell-input"))&&(R=!1,H())},10)}))}function se(){const e=f("table-body");return(e==null?void 0:e.querySelectorAll("tr[data-id]:not(.hidden-by-group)"))||document.querySelectorAll(".nonexistent")}function In(e){const t=se();if(t.length===0)return;const n=document.activeElement;if(!((n==null?void 0:n.tagName)==="INPUT"&&!n.classList.contains("cell-input"))){if(R){e.key==="Escape"?(e.preventDefault(),we(!0)):e.key==="Enter"?(e.preventDefault(),we(!1)):e.key==="Tab"&&(e.preventDefault(),we(!1),Ye(e.shiftKey),Ge());return}switch(e.key){case"ArrowUp":e.preventDefault(),b>0&&(b--,H());break;case"ArrowDown":e.preventDefault(),b<t.length-1?(b++,H()):b===-1&&t.length>0&&(b=0,H());break;case"ArrowLeft":e.preventDefault(),C==="value"&&(C="name",H());break;case"ArrowRight":e.preventDefault(),C==="name"&&(C="value",H());break;case"Enter":e.preventDefault(),b>=0&&Ge();break;case"Tab":e.preventDefault(),b===-1&&t.length>0&&(b=0),Ye(e.shiftKey);break}}}function Ye(e){const t=se();t.length!==0&&(e?C==="value"?C="name":b>0&&(b--,C="value"):C==="name"?C="value":b<t.length-1&&(b++,C="name"),H())}function Ge(){const e=se();if(b<0||b>=e.length)return;const t=e[b],n=C==="name"?t.querySelector(".name-cell .cell-input"):t.querySelector(".value-cell .cell-input, .color-value-cell .cell-input");n&&(R=!0,n.focus(),n.select(),H())}function we(e){const t=document.activeElement;e&&(t!=null&&t.classList.contains("cell-input"))&&(t.value=t.defaultValue),t!=null&&t.classList.contains("cell-input")&&t.blur(),R=!1;const n=document.querySelector(".table-container");n&&n.focus(),H()}function H(){if(document.querySelectorAll(".cell-focused").forEach(s=>{s.classList.remove("cell-focused")}),document.querySelectorAll("tr.row-focused").forEach(s=>{s.classList.remove("row-focused")}),b<0)return;const e=se();if(b>=e.length)return;const t=e[b];t.classList.add("row-focused");const n=C==="name"?t.querySelector(".name-cell"):t.querySelector(".value-cell, .color-value-cell");n&&!R&&n.classList.add("cell-focused")}function xn(){b=-1,C="name",R=!1}let Z=!1,Ee={width:0,height:0};function Bn(){const e=f("expand-btn"),t=e==null?void 0:e.querySelector(".icon");if(Z){const n=Ee.width||600,s=Ee.height||500;E({type:"resize",width:n,height:s}),Z=!1,e&&(e.title="Expand"),t&&(t.innerHTML=P.expand)}else{Ee={width:window.innerWidth,height:window.innerHeight};const n=Math.max(400,window.screen.availWidth-20),s=Math.max(300,window.screen.availHeight-100);E({type:"resize",width:n,height:s}),Z=!0,e&&(e.title="Collapse"),t&&(t.innerHTML=P.collapse)}}function kn(){const e=document.querySelectorAll("[data-resize]");let t=!1,n=0,s=0,o=0,a=0,l="corner";e.forEach(c=>{c.addEventListener("mousedown",r=>{if(l=r.currentTarget.dataset.resize||"corner",t=!0,n=r.clientX,s=r.clientY,o=window.innerWidth,a=window.innerHeight,Z){Z=!1;const d=f("expand-btn"),u=d==null?void 0:d.querySelector(".icon");d&&(d.title="Expand"),u&&(u.innerHTML=P.expand)}r.preventDefault()})}),document.onmousemove=c=>{if(!t)return;const r=c.clientX-n,i=c.clientY-s;let d=o,u=a;l==="right"||l==="corner"?d=o+r:l==="left"&&(d=o-r),l==="bottom"||l==="corner"?u=a+i:l==="top"&&(u=a-i),d=Math.max(400,d),u=Math.max(300,u),E({type:"resize",width:d,height:u})},document.onmouseup=()=>{t=!1}}function st(){const e=f("json-editor");e&&(e.value=JSON.stringify({collections:m.collections,variables:m.variables.map(t=>({id:t.id,collectionId:t.collectionId,name:t.name,type:t.resolvedType,value:t.value}))},null,2))}function $n(e){m.toggleGroup(e),ee()}function Cn(e){const t=e.split(",");confirm(`Delete all ${t.length} variables in this group?`)&&E({type:"delete-group",ids:t})}function Ln(e,t,n){const s=n.split("/");let o;s.length>1?(s[s.length-1]=t,o=s.join("/")):o=t,o!==n&&E({type:"update-variable-name",id:e,name:o})}function Te(e,t){E({type:"update-variable-value",id:e,value:t})}function Mn(e,t,n){}function ot(e,t){Ke(t,n=>{Te(e,xe(n))})}function Ie(e,t){const n=f("status");n&&(n.textContent=e,n.className="status "+t,t==="success"&&setTimeout(()=>{n.textContent="",n.className="status"},2e3))}window.onmessage=e=>{const t=e.data.pluginMessage;t&&(t.type==="data-loaded"&&(m.setData(t.collections||[],t.variables||[]),ft(),ee(),ie(),st(),xn()),t.type==="update-success"&&Ie("Saved","success"),t.type==="update-error"&&Ie("Error: "+t.error,"warning"),t.type==="changes-detected"&&Ie("Changes detected - click Refresh","warning"))};document.addEventListener("DOMContentLoaded",()=>{on();const e=f("json-format-btn"),t=f("json-update-btn"),n=f("json-editor");e&&n&&(e.onclick=()=>{try{n.value=JSON.stringify(JSON.parse(n.value),null,2),n.classList.remove("error")}catch{n.classList.add("error")}}),t&&n&&(t.onclick=()=>{try{E({type:"update-from-json",data:JSON.parse(n.value)}),n.classList.remove("error")}catch{n.classList.add("error")}})});

</script>
  <style>
:root{--bg: #ffffff;--bg-alt: #f9f9f9;--bg-hover: #f0f0f0;--bg-selected: #e8f4ff;--border: #e0e0e0;--text: #1e1e1e;--text-dim: #666;--accent: #18a0fb;--danger: #e03e3e;--success: #1bc47d}*{box-sizing:border-box;margin:0;padding:0}body{font-family:Inter,-apple-system,sans-serif;font-size:12px;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden}.spacer{flex:1}.toolbar{display:flex;align-items:center;gap:8px;padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg-alt)}.toolbar-group{display:flex;align-items:center;gap:4px}.toolbar-divider{width:1px;height:20px;background:var(--border);margin:0 8px}.btn{display:flex;align-items:center;gap:4px;padding:6px 10px;border:1px solid var(--border);border-radius:4px;background:var(--bg);font-size:11px;cursor:pointer;color:var(--text)}.btn:hover{background:var(--bg-hover)}.btn-icon{padding:6px}.btn svg{width:14px;height:14px}.btn-primary{background:var(--accent);border-color:var(--accent);color:#fff}.btn-primary:hover{background:#0d8de5}.btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}.btn-danger:hover{background:#c43030}.collection-select{padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:11px;min-width:140px}.status{font-size:10px;padding:4px 8px;border-radius:4px}.status.success{background:#e6f9f0;color:var(--success)}.status.warning{background:#fff8e6;color:#b86e00}.search-wrapper{display:flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid var(--border);border-radius:4px;background:var(--bg);min-width:140px}.search-wrapper:focus-within{border-color:var(--accent)}.search-icon{color:var(--text-dim);display:flex;align-items:center}.search-icon svg{width:12px;height:12px}.search-input{border:none;background:none;font-size:11px;outline:none;width:100%;color:var(--text)}.search-input::placeholder{color:var(--text-dim)}.search-count{font-size:10px;color:var(--text-dim);white-space:nowrap}.tabs{display:flex;align-items:center;background:var(--bg-alt);border-bottom:1px solid var(--border);padding-right:8px;gap:2px}.tab{padding:8px 16px;border:none;background:none;font-size:11px;font-weight:500;color:var(--text-dim);cursor:pointer;border-bottom:2px solid transparent}.tab:hover{color:var(--text)}.tab.active{color:var(--accent);border-bottom-color:var(--accent)}.tab-content{display:none;flex:1;flex-direction:column;overflow:hidden}.tab-content.active{display:flex}.json-panel{flex:1;display:flex;flex-direction:column;padding:12px;gap:8px}.json-editor{flex:1;border:1px solid var(--border);border-radius:4px;padding:12px;font-family:SF Mono,Monaco,monospace;font-size:11px;resize:none;outline:none}.json-editor:focus{border-color:var(--accent)}.json-editor.error{border-color:var(--danger);background:#fff5f5}.table-container{flex:1;overflow:auto}.spreadsheet{width:100%;border-collapse:collapse;table-layout:fixed}.spreadsheet th,.spreadsheet td{border:1px solid var(--border);padding:0;height:32px;text-align:left;vertical-align:middle}.spreadsheet th{background:var(--bg-alt);font-weight:600;font-size:10px;text-transform:uppercase;color:var(--text-dim);padding:0 10px;position:sticky;top:0;z-index:10}.spreadsheet th.col-name{width:40%;padding-left:10px}.spreadsheet th.col-value{padding-left:10px}.spreadsheet th.col-actions{width:80px;text-align:center}.spreadsheet tbody tr:hover{background:var(--bg-hover)}.spreadsheet tbody tr.selected{background:var(--bg-selected)}.group-row td{background:var(--bg-alt);border-bottom:1px solid var(--border)}.group-row:hover td{background:var(--bg-hover)}.group-row:hover .row-action{opacity:1!important}.group-header{display:flex;align-items:center;gap:4px;padding:0 10px;font-weight:600;font-size:12px;color:var(--text);cursor:pointer;-webkit-user-select:none;user-select:none}.group-header .type-icon{width:18px;height:18px}.group-header .type-icon svg{width:18px;height:18px}.group-toggle{width:16px;height:16px;display:flex;align-items:center;justify-content:center;color:var(--text-dim);transition:transform .15s}.group-toggle.collapsed{transform:rotate(-90deg)}.group-toggle svg{width:10px;height:10px}tr.grouped-item .cell-input:first-of-type{padding-left:26px}tr.hidden-by-group{display:none}.empty-state-row td{background:transparent;border:none}.row-actions{display:flex;align-items:center;justify-content:center;gap:4px;opacity:1}.row-action{width:24px;height:24px;border:none;background:none;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-dim);transition:all .15s}.row-action:hover{background:var(--bg-hover);color:var(--text)}.row-action.danger:hover{background:#ffe5e5;color:var(--danger)}.row-action svg{width:13px;height:13px}.empty-state{padding:60px 20px;text-align:center;color:var(--text-dim)}.drag-handle{width:16px;height:16px;display:flex;align-items:center;justify-content:center;color:var(--text-dim);cursor:grab;opacity:0;transition:opacity .1s;flex-shrink:0}.drag-handle:active{cursor:grabbing}.drag-handle svg{width:12px;height:12px}tr:hover .drag-handle{opacity:.5}tr:hover .drag-handle:hover{opacity:1}tr.dragging{opacity:.5;background:var(--bg-selected)}tr.drag-over{border-top:2px solid var(--accent)}tr.drag-over-below{border-bottom:2px solid var(--accent)}.cell{padding:0 10px;height:100%;display:flex;align-items:center}.cell-input{width:100%;height:100%;border:none;background:transparent;font-size:12px;font-family:inherit;padding:0 10px;outline:none}.cell-input:focus{background:#fff;box-shadow:inset 0 0 0 2px var(--accent)}.cell-input.mono{font-family:SF Mono,Monaco,monospace;font-size:11px}.name-cell{display:flex;align-items:center;gap:8px;height:100%;padding-left:10px}.name-cell .cell-input{flex:1}.color-value-cell{display:flex;align-items:center;gap:8px;height:100%;padding-left:10px}.color-value-cell .cell-input{flex:1}.value-cell{display:flex;align-items:center;height:100%;padding-left:10px}.value-cell .cell-input{flex:1}.type-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.type-icon svg{width:24px;height:24px}.type-icon.COLOR svg{color:#c41e3a}.type-icon.FLOAT svg{color:#3a5bc4}.type-icon.STRING svg{color:#2e8b57}.type-icon.BOOLEAN svg{color:#c47a1e}.color-swatch{width:24px;height:24px;border-radius:4px;border:1px solid var(--border);cursor:pointer;position:relative;overflow:hidden}.color-swatch:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(45deg,#ddd 25%,transparent 25%),linear-gradient(-45deg,#ddd 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ddd 75%),linear-gradient(-45deg,transparent 75%,#ddd 75%);background-size:6px 6px;background-position:0 0,0 3px,3px -3px,-3px 0px}.color-swatch-inner{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1}.color-swatch input{position:absolute;top:0;right:0;bottom:0;left:0;opacity:0;cursor:pointer}.bool-toggle{display:flex;border:1px solid var(--border);border-radius:4px;overflow:hidden}.bool-toggle button{padding:4px 12px;border:none;background:var(--bg);font-size:10px;cursor:pointer}.bool-toggle button:first-child{border-right:1px solid var(--border)}.bool-toggle button.active{background:var(--accent);color:#fff}.cell-focused{position:relative}.cell-focused:after{content:"";position:absolute;top:2px;right:2px;bottom:2px;left:2px;border:2px solid var(--accent);border-radius:2px;pointer-events:none}.name-cell,.value-cell,.color-value-cell{position:relative}tr.row-focused{background:var(--bg-selected)!important}.table-container:focus{outline:none}.table-container:focus-visible{outline:none}.modal-overlay{position:fixed;top:0;right:0;bottom:0;left:0;background:#00000080;display:none;align-items:center;justify-content:center;z-index:200}.modal-overlay.open{display:flex}.modal{background:var(--bg);border-radius:8px;box-shadow:0 8px 32px #0003;width:360px;max-height:90vh;overflow:auto}.modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}.modal-header h3{font-size:13px;font-weight:600}.modal-close{width:24px;height:24px;border:none;background:none;cursor:pointer;border-radius:4px;display:flex;align-items:center;justify-content:center;color:var(--text-dim)}.modal-close:hover{background:var(--bg-hover);color:var(--text)}.modal-body{padding:16px;display:flex;flex-direction:column;gap:16px}.modal-footer{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}.form-group{display:flex;flex-direction:column;gap:6px}.form-group label{font-size:11px;font-weight:500;color:var(--text-dim)}.form-input{padding:8px 10px;border:1px solid var(--border);border-radius:4px;font-size:12px;outline:none}.form-input:focus{border-color:var(--accent)}.form-row{display:flex;gap:12px}.form-row .form-group{flex:1}.color-input-wrapper{display:flex;align-items:center;gap:8px}.color-input-wrapper .form-input{flex:1}.color-input-preview{width:32px;height:32px;border-radius:4px;border:1px solid var(--border);cursor:pointer;position:relative;overflow:hidden;flex-shrink:0}.color-input-preview:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(45deg,#ddd 25%,transparent 25%),linear-gradient(-45deg,#ddd 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ddd 75%),linear-gradient(-45deg,transparent 75%,#ddd 75%);background-size:6px 6px;background-position:0 0,0 3px,3px -3px,-3px 0px}.color-input-preview .color-fill{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1}.color-input-preview input{position:absolute;top:0;right:0;bottom:0;left:0;opacity:0;cursor:pointer}.shades-preview{display:flex;height:32px}.shades-preview-item{flex:1;height:100%}.form-group>.shades-preview{border-radius:4px;overflow:hidden;border:1px solid var(--border)}.curve-preview-combined{border:1px solid var(--border);border-radius:4px;overflow:hidden;display:flex;flex-direction:column}.curve-svg{display:block;background:var(--bg-alt);flex-shrink:0;min-height:100px}.curve-node,.curve-handle{transition:transform .1s,r .1s}.curve-node:hover,.curve-handle:hover{filter:brightness(1.1)}.curve-node:hover{stroke-width:3}.curve-handle:hover{r:7}.curve-property-select{font-size:10px;padding:2px 6px;border:1px solid var(--border);border-radius:3px;background:var(--bg);color:var(--text);margin-left:8px;cursor:pointer}.curve-property-select:focus{outline:none;border-color:var(--accent)}.form-group label{display:flex;align-items:center}.steps-preview{border:1px solid var(--border);border-radius:4px;max-height:200px;overflow-y:auto}.steps-preview-list{display:flex;flex-direction:column}.steps-preview-item{display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:11px}.steps-preview-item:last-child{border-bottom:none}.steps-preview-item.base{background:var(--bg-selected);font-weight:600}.steps-preview-item .step-name{color:var(--text-dim)}.steps-preview-item .step-value{font-family:SF Mono,Monaco,monospace}.color-reference-list{max-height:400px;overflow-y:auto;border:1px solid var(--border);border-radius:4px;margin-top:8px}.color-reference-group:not(:last-child){border-bottom:1px solid var(--border)}.color-reference-group.hidden{display:none}.color-reference-group-header{padding:8px 12px;background:var(--bg-alt);font-size:10px;font-weight:600;text-transform:uppercase;color:var(--text-dim);border-bottom:1px solid var(--border)}.color-reference-item{display:flex;align-items:center;gap:8px;padding:6px 10px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .1s}.color-reference-item:last-child{border-bottom:none}.color-reference-item:hover{background:var(--bg-hover)}.color-reference-item.hidden{display:none}.color-reference-item.selected{background:var(--bg-selected);border-left:2px solid var(--accent);padding-left:8px}.color-reference-swatch{width:24px;height:24px;border-radius:4px;border:1px solid var(--border);flex-shrink:0;position:relative;overflow:hidden}.color-reference-swatch:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(45deg,#ddd 25%,transparent 25%),linear-gradient(-45deg,#ddd 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ddd 75%),linear-gradient(-45deg,transparent 75%,#ddd 75%);background-size:6px 6px;background-position:0 0,0 3px,3px -3px,-3px 0px}.color-reference-swatch-inner{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1}.color-reference-name{flex:1;font-size:12px;color:var(--text);font-family:SF Mono,Monaco,monospace}.bulk-edit-textarea{width:100%;min-height:200px;padding:10px;border:1px solid var(--border);border-radius:4px;font-family:SF Mono,Monaco,monospace;font-size:12px;line-height:1.6;resize:vertical;outline:none}.bulk-edit-textarea:focus{border-color:var(--accent)}.bulk-edit-preview{border:1px solid var(--border);border-radius:4px;max-height:150px;overflow-y:auto}.bulk-edit-preview:empty{display:none}.bulk-edit-preview-item{display:flex;align-items:center;gap:8px;padding:6px 10px;border-bottom:1px solid var(--border);font-size:11px}.bulk-edit-preview-item:last-child{border-bottom:none}.bulk-edit-preview-item .preview-name{flex:1;font-family:SF Mono,Monaco,monospace}.bulk-edit-preview-item .preview-value{font-family:SF Mono,Monaco,monospace;color:var(--text-dim)}.bulk-edit-preview-item .preview-swatch{width:16px;height:16px;border-radius:3px;border:1px solid var(--border);flex-shrink:0}.bulk-edit-preview-item .preview-status{font-size:10px;padding:2px 6px;border-radius:3px}.bulk-edit-preview-item .preview-status.new{background:#e6f9f0;color:var(--success)}.bulk-edit-preview-item .preview-status.modified{background:#fff8e6;color:#b86e00}.color-picker-container{display:flex;flex-direction:column;gap:16px}.picker-sv-panel{width:100%;height:180px;border-radius:8px;position:relative;cursor:crosshair;background:linear-gradient(to right,#fff,red)}.picker-sv-panel:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(to bottom,transparent,#000);border-radius:8px;pointer-events:none}.picker-sv-handle{position:absolute;width:18px;height:18px;border:3px solid white;border-radius:50%;box-shadow:0 0 0 1px #0003,inset 0 0 0 1px #0003;transform:translate(-50%,-50%);pointer-events:none;z-index:2;background:transparent}.picker-hue-slider{width:100%;height:16px;border-radius:8px;background:linear-gradient(to right,red,#ff0,#0f0,#0ff,#00f,#f0f,red);position:relative;cursor:pointer}.picker-hue-handle{position:absolute;top:50%;width:20px;height:20px;background:transparent;border:3px solid white;border-radius:50%;box-shadow:0 0 0 1px #0003,inset 0 0 0 1px #0003;transform:translate(-50%,-50%);pointer-events:none}.color-picker-inputs{display:flex;gap:8px;align-items:center}.color-picker-inputs .form-input{width:100%;box-sizing:border-box;text-align:center;font-family:SF Mono,Monaco,monospace;font-size:11px;border-radius:8px}.add-menu,.color-value-menu{position:absolute;background:#fff;border:1px solid var(--border);border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px;z-index:100;display:none}.add-menu.open,.color-value-menu.open{display:block}.add-menu button,.color-value-menu button{display:flex;align-items:center;gap:8px;width:100%;padding:8px 12px;border:none;background:none;text-align:left;font-size:12px;cursor:pointer;border-radius:4px;white-space:nowrap}.add-menu button svg,.color-value-menu button svg{flex-shrink:0}.add-menu button[data-type=COLOR] svg,.color-value-menu button[data-type=COLOR] svg{color:#c41e3a}.add-menu button[data-type=FLOAT] svg,.color-value-menu button[data-type=FLOAT] svg{color:#3a5bc4}.add-menu button[data-type=STRING] svg,.color-value-menu button[data-type=STRING] svg{color:#2e8b57}.add-menu button[data-type=BOOLEAN] svg,.color-value-menu button[data-type=BOOLEAN] svg{color:#c47a1e}.add-menu button:hover,.color-value-menu button:hover{background:var(--bg-hover)}.resize-handle{position:fixed;z-index:1000}.resize-handle--top,.resize-handle--bottom{left:0;right:0;height:6px;cursor:ns-resize}.resize-handle--top{top:0}.resize-handle--bottom{bottom:0}.resize-handle--left,.resize-handle--right{top:0;bottom:0;width:6px;cursor:ew-resize}.resize-handle--left{left:0}.resize-handle--right{right:0}.resize-handle--corner{bottom:0;right:0;width:16px;height:16px;cursor:nwse-resize}.resize-handle--corner:before{content:"";position:absolute;bottom:3px;right:3px;width:8px;height:8px;border-right:2px solid var(--border);border-bottom:2px solid var(--border)}.resize-handle--corner:hover:before{border-color:var(--text-dim)}

</style>
</head>
<body>
  <div class="tabs">
    <button class="tab active" data-tab="table">Table</button>
    <button class="tab" data-tab="json">JSON</button>
    <div class="spacer"></div>
    <button id="refresh-btn" class="btn btn-icon" title="Refresh">
      <span class="icon" data-icon="refresh"></span>
    </button>
    <button id="expand-btn" class="btn btn-icon" title="Expand">
      <span class="icon" data-icon="expand"></span>
    </button>
  </div>

  <!-- Table Tab -->
  <div id="table-tab" class="tab-content active">
    <div class="toolbar">
      <div class="toolbar-group">
        <select id="collection-select" class="collection-select"></select>
        <button id="add-collection-btn" class="btn btn-icon" title="New Collection">
          <span class="icon" data-icon="plus"></span>
        </button>
      </div>

      <div class="toolbar-divider"></div>

      <div class="toolbar-group">
        <button id="add-variable-btn" class="btn btn-primary">
          <span class="icon" data-icon="plus"></span>
          Add Variable
        </button>
        <button id="shades-btn" class="btn" title="Generate Color Shades">
          <span class="icon" data-icon="shades"></span>
          Shades
        </button>
        <button id="steps-btn" class="btn" title="Generate Number Steps">
          <span class="icon" data-icon="steps"></span>
          Steps
        </button>
      </div>

      <div class="spacer"></div>

      <div class="search-wrapper">
        <span class="search-icon" data-icon="search"></span>
        <input type="text" id="search-input" class="search-input" placeholder="Search...">
        <span id="search-count" class="search-count"></span>
      </div>

      <span id="status" class="status"></span>
    </div>

    <div class="table-container">
      <table class="spreadsheet">
        <thead>
          <tr>
            <th class="col-name">Name</th>
            <th class="col-value">Value</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>

    <!-- Add Menu -->
    <div id="add-menu" class="add-menu">
      <button data-type="COLOR"><span class="icon" data-icon="type-COLOR"></span>Color</button>
      <button data-type="FLOAT"><span class="icon" data-icon="type-FLOAT"></span>Number</button>
      <button data-type="STRING"><span class="icon" data-icon="type-STRING"></span>String</button>
      <button data-type="BOOLEAN"><span class="icon" data-icon="type-BOOLEAN"></span>Boolean</button>
    </div>

    <!-- Color Value Menu -->
    <div id="color-value-menu" class="color-value-menu">
      <button data-action="pick"><span class="icon" data-icon="shades"></span>Pick Color</button>
      <button data-action="reference"><span class="icon" data-icon="type-COLOR"></span>Reference Color</button>
    </div>
  </div>

  <!-- JSON Tab -->
  <div id="json-tab" class="tab-content">
    <div class="json-panel">
      <textarea id="json-editor" class="json-editor" spellcheck="false"></textarea>
      <div style="display:flex;gap:8px;">
        <button id="json-update-btn" class="btn btn-primary">Update</button>
        <button id="json-format-btn" class="btn">Format</button>
      </div>
    </div>
  </div>

  <!-- Shades Generator Modal -->
  <div id="shades-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Generate Color Shades</h3>
        <button class="modal-close" onclick="window.app.closeShadesModal()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Select Color</label>
          <select id="shades-source" class="form-input" onchange="window.app.selectSourceColor()">
            <option value="">-- Select a color --</option>
          </select>
        </div>

        <div id="shades-options" style="display:none;flex-direction:column;gap:16px;">
          <div class="form-group">
            <label>Group Name</label>
            <input type="text" id="shades-name" class="form-input" placeholder="e.g. blue, primary, brand" value="">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Base Color</label>
              <div class="color-input-wrapper">
                <div class="color-input-preview" onclick="window.app.openShadesColorPicker()" style="cursor:pointer;">
                  <div class="color-fill" id="shades-base-preview" style="background: transparent"></div>
                </div>
                <input type="hidden" id="shades-base-color" value="">
                <input type="text" id="shades-base-hex" class="form-input mono" value="" placeholder="#000000" oninput="window.app.updateBaseFromHex()">
              </div>
            </div>
            <div class="form-group">
              <label>Shades</label>
              <input type="number" id="shades-count" class="form-input" value="11" min="2" max="20" oninput="window.app.updateShadesPreview()" style="width:60px;">
            </div>
          </div>

          <div class="form-group">
            <label>
              <span>Preview</span>
              <select id="shades-curve-property" class="curve-property-select" onchange="window.app.updateCurveEditor()">
                <option value="lightness" selected>Lightness</option>
                <option value="saturation">Saturation</option>
                <option value="hue">Hue</option>
              </select>
            </label>
            <div class="curve-preview-combined" id="shades-curve-editor">
              <svg class="curve-svg" id="shades-curve-svg"></svg>
              <div class="shades-preview" id="shades-preview"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="shades-remove-btn" class="btn btn-danger" onclick="window.app.removeShades()" style="display:none;">Remove Shades</button>
        <div class="spacer"></div>
        <button class="btn" onclick="window.app.closeShadesModal()">Cancel</button>
        <button id="shades-generate-btn" class="btn btn-primary" onclick="window.app.generateShades()">Generate</button>
      </div>
    </div>
  </div>

  <!-- Input Modal -->
  <div id="input-modal" class="modal-overlay">
    <div class="modal" style="width: 300px;">
      <div class="modal-header">
        <h3 id="input-modal-title">Enter Name</h3>
        <button class="modal-close" onclick="window.app.closeInputModal()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label id="input-modal-label">Name</label>
          <input type="text" id="input-modal-input" class="form-input" placeholder="Enter name...">
          <select id="input-modal-select" class="form-input" style="display:none;"></select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="window.app.closeInputModal()">Cancel</button>
        <button id="input-modal-confirm" class="btn btn-primary">Create</button>
      </div>
    </div>
  </div>

  <!-- Color Picker Modal -->
  <div id="color-picker-modal" class="modal-overlay">
    <div class="modal" style="width: 300px;">
      <div class="modal-header">
        <h3>Pick Color</h3>
        <button class="modal-close" onclick="window.app.closeColorPicker()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="color-picker-container">
          <div id="sv-panel" class="picker-sv-panel">
            <div id="sv-handle" class="picker-sv-handle"></div>
          </div>
          <div id="hue-slider" class="picker-hue-slider">
            <div id="hue-handle" class="picker-hue-handle"></div>
          </div>
          <div class="color-picker-inputs">
            <input type="text" id="picker-hex-input" class="form-input" placeholder="#000000">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="window.app.closeColorPicker()">Cancel</button>
        <button class="btn btn-primary" onclick="window.app.confirmColorPicker()">Apply</button>
      </div>
    </div>
  </div>

  <!-- Color Reference Modal -->
  <div id="color-reference-modal" class="modal-overlay">
    <div class="modal" style="width: 360px;">
      <div class="modal-header">
        <h3>Reference Color</h3>
        <button class="modal-close" onclick="window.app.closeColorReferenceModal()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Select a color variable</label>
          <input type="text" id="color-reference-search" class="form-input" placeholder="Search colors..." oninput="window.app.filterColorReferences(this.value)" onkeydown="window.app.handleColorReferenceSearchKey(event)">
        </div>
        <div id="color-reference-list" class="color-reference-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="window.app.closeColorReferenceModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Bulk Edit Modal -->
  <div id="bulk-edit-modal" class="modal-overlay">
    <div class="modal" style="width: 480px;">
      <div class="modal-header">
        <h3>Edit as Text: <span id="bulk-edit-group-name"></span></h3>
        <button class="modal-close" onclick="window.app.closeBulkEdit()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>One variable per line: <code>name, value</code></label>
          <textarea id="bulk-edit-textarea" class="bulk-edit-textarea" spellcheck="false" placeholder="50, #FFFFFF&#10;100, #F5F5F5&#10;200, #EEEEEE"></textarea>
        </div>
        <div id="bulk-edit-preview" class="bulk-edit-preview"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="window.app.closeBulkEdit()">Cancel</button>
        <button class="btn btn-primary" onclick="window.app.applyBulkEdit()">Apply Changes</button>
      </div>
    </div>
  </div>

  <!-- Steps Generator Modal -->
  <div id="steps-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Generate Number Steps</h3>
        <button class="modal-close" onclick="window.app.closeStepsModal()">
          <span class="icon" data-icon="close"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Select Number Variable</label>
          <select id="steps-source" class="form-input" onchange="window.app.selectSourceNumber()">
            <option value="">-- Select a number --</option>
          </select>
        </div>

        <div id="steps-options" style="display:none;flex-direction:column;gap:16px;">
          <div class="form-group">
            <label>Group Name</label>
            <input type="text" id="steps-name" class="form-input" placeholder="e.g. spacing" value="">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Base Value</label>
              <input type="number" id="steps-base-value" class="form-input" value="16" min="0" step="any" oninput="window.app.updateStepsPreview()">
            </div>
            <div class="form-group">
              <label>Base Step</label>
              <select id="steps-base-step" class="form-input" onchange="window.app.onBaseStepChange()"></select>
            </div>
          </div>

          <div class="form-group">
            <label>Scale Ratio</label>
            <div class="form-row">
              <select id="steps-ratio-preset" class="form-input" onchange="window.app.selectRatioPreset()">
                <option value="1.125">Minor Second (1.125)</option>
                <option value="1.2">Minor Third (1.2)</option>
                <option value="1.25" selected>Major Third (1.25)</option>
                <option value="1.333">Perfect Fourth (1.333)</option>
                <option value="1.414">Augmented Fourth (1.414)</option>
                <option value="1.5">Perfect Fifth (1.5)</option>
                <option value="1.618">Golden Ratio (1.618)</option>
                <option value="2">Octave (2)</option>
                <option value="custom">Custom...</option>
              </select>
              <input type="number" id="steps-ratio-custom" class="form-input" value="1.25" min="1" step="0.001" oninput="window.app.updateStepsPreview()" style="width:80px;" disabled>
            </div>
          </div>

          <div class="form-group">
            <label>Steps</label>
            <div class="form-row">
              <select id="steps-list-preset" class="form-input" onchange="window.app.selectStepsPreset()">
                <option value="tshirt">T-shirt (xs-3xl)</option>
                <option value="numeric">Numeric (1-10)</option>
                <option value="gutenberg">Gutenberg (xs-ultra)</option>
                <option value="custom">Custom...</option>
              </select>
            </div>
            <input type="text" id="steps-list" class="form-input mono" value="xs, sm, md, lg, xl, 2xl, 3xl" oninput="window.app.onStepsListInput()" style="margin-top:6px;">
          </div>

          <div class="form-group">
            <label>Preview</label>
            <div class="steps-preview" id="steps-preview"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="steps-remove-btn" class="btn btn-danger" onclick="window.app.removeSteps()" style="display:none;">Remove Steps</button>
        <div class="spacer"></div>
        <button class="btn" onclick="window.app.closeStepsModal()">Cancel</button>
        <button id="steps-generate-btn" class="btn btn-primary" onclick="window.app.generateSteps()">Generate</button>
      </div>
    </div>
  </div>

  <!-- Resize Handles -->
  <div class="resize-handle resize-handle--top" data-resize="top"></div>
  <div class="resize-handle resize-handle--right" data-resize="right"></div>
  <div class="resize-handle resize-handle--bottom" data-resize="bottom"></div>
  <div class="resize-handle resize-handle--left" data-resize="left"></div>
  <div class="resize-handle resize-handle--corner" data-resize="corner"></div>

</body>
</html>
